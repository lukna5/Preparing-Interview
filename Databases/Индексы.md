# –ò–¥–µ—è 
–ò–Ω–¥–µ–∫—Å—ã ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —É—Å–∫–æ—Ä—è—é—Ç –ø–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö. –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –∫–Ω–∏–≥–µ ‚Äî –ø–æ–∑–≤–æ–ª—è—é—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞.

## B-tree –∏–Ω–¥–µ–∫—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ PSQL)
### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- –î–ª—è —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (`=`)
- –î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (`<`, `<=`, `>`, `>=`, `BETWEEN`)
- –î–ª—è `ORDER BY`

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ (B-–¥–µ—Ä–µ–≤–æ)**.
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –¥–µ—Ä–µ–≤–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ–¥–¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π.
- –ü—Ä–∏ –ø–æ–∏—Å–∫–µ PostgreSQL "—Å–ø—É—Å–∫–∞–µ—Ç—Å—è" –ø–æ –¥–µ—Ä–µ–≤—É, –æ—Ç –∫–æ—Ä–Ω—è –∫ –ª–∏—Å—Ç—É, –æ—Ç—Å–µ–∫–∞—è –Ω–µ–Ω—É–∂–Ω—ã–µ –≤–µ—Ç–≤–∏.

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è:
- –ò–Ω–¥–µ–∫—Å—ã ‚Äî —ç—Ç–æ **–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã**, –ª–µ–∂–∞—â–∏–µ –≤ —Å–≤–æ–∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö **—Ñ–∞–π–ª–∞—Ö** –Ω–∞ –¥–∏—Å–∫–µ.
- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `base/` (–∫–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏ –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –Ω–æ–º–µ—Ä–æ–º OID).
- –ò—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ `pg_class` –∏ `pg_index`.

### ‚úèÔ∏è –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
#### –í—Å—Ç–∞–≤–∫–∞:
- PostgreSQL –≤—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É.
- –ó–∞—Ç–µ–º –∏–¥—ë—Ç –≤ B-tree –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª—é—á –≤ –Ω—É–∂–Ω—ã–π –ª–∏—Å—Ç–æ–≤–æ–π —É–∑–µ–ª.
- –ï—Å–ª–∏ —É–∑–µ–ª –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî –¥–µ–ª–∞–µ—Ç—Å—è **—Ä–∞–∑–±–∏–µ–Ω–∏–µ —É–∑–ª–∞** (split), –≤–æ–∑–º–æ–∂–Ω–æ —Å –ø–æ–¥—ä–µ–º–æ–º –∫–ª—é—á–∞ –≤–≤–µ—Ä—Ö.

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:

- –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º–æ–µ –ø–æ–ª–µ –≤—Ö–æ–¥–∏—Ç –≤ –∏–Ω–¥–µ–∫—Å:
    - –°—Ç–∞—Ä—ã–π –∏–Ω–¥–µ–∫—Å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª—è–µ—Ç—Å—è (–ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "–º–µ—Ä—Ç–≤—ã–π").
    - –ù–æ–≤—ã–π ‚Äî –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ PostgreSQL ‚Äî —ç—Ç–æ `DELETE + INSERT` –Ω–∞ —É—Ä–æ–≤–Ω–µ MVCC.


#### –£–¥–∞–ª–µ–Ω–∏–µ:

- –ò–Ω–¥–µ–∫—Å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ **–ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –º–µ—Ä—Ç–≤—ã–π**, –Ω–æ **–Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É** (—ç—Ç–æ –≤–∞–∂–Ω–æ!).
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –ø–æ—Ç–æ–º `VACUUM`.
## Hash –∏–Ω–¥–µ–∫—Å
### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (`=`)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è **—Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è**, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–µ.
- PostgreSQL —Å—á–∏—Ç–∞–µ—Ç **—Ö–µ—à –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è**.
- –ü–æ–º–µ—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω—É–∂–Ω—ã–π "bucket" (—Å–µ–≥–º–µ–Ω—Ç), –∏—Å—Ö–æ–¥—è –∏–∑ —Ö–µ—à–∞.
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é (`=`), –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
- –ù–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ (`<`, `>`, –∏ —Ç.–¥.).
- –î–æ PostgreSQL 10 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª WAL (–Ω–µ–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π), —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç.

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è:
- –¢–∞–∫–∂–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ.
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã: **–æ—Ç–¥–µ–ª—å–Ω—ã–µ "–±–ª–æ–∫–∏-—Å—Ç—Ä–∞–Ω–∏—Ü—ã"**, –∫–∞–∂–¥–∞—è —Ö—Ä–∞–Ω–∏—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è + TID.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
#### –í—Å—Ç–∞–≤–∫–∞:
- –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Å—Ç—Ä–æ–∫–∏ —Ö–µ—à —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ, –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ bucket.
- –ï—Å–ª–∏ bucket –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π, PostgreSQL –º–æ–∂–µ—Ç **—Ä–∞—Å—à–∏—Ä–∏—Ç—å** —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É (–ø–µ—Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∑–∞—Ç—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è).
#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
- –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, —Å—Ç–∞—Ä—ã–π –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è, –Ω–æ–≤—ã–π –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è.

#### –£–¥–∞–ª–µ–Ω–∏–µ:
- –ü–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–π, –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ `VACUUM`.

## GIN –∏–Ω–¥–µ–∫—Å 
**GIN** (Generalized Inverted Index) ‚Äî —ç—Ç–æ —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏—Å–∫–∞—Ç—å **–≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö**, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- –º–∞—Å—Å–∏–≤–æ–≤
- JSON / JSONB
- —Ç–µ–∫—Å—Ç–∞ (–¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞)
- —Å—Ç—Ä–æ–∫ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ (`%abc%`) ‚Äî —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `pg_trgm`

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –æ–±—ã—á–Ω—ã–π B-tree –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é,  
–∞ GIN ‚Äî —ç—Ç–æ **–æ–±—Ä–∞—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å**: –æ–Ω –∑–Ω–∞–µ—Ç, **–≤ –∫–∞–∫–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç**

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç GIN –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?

–í–æ—Ç –∏–¥–µ—è:
- –î–æ–ø—É—Å—Ç–∏–º —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞:
    `tags = ['python', 'sql', 'index']`
- GIN —Ä–∞–∑–æ–±—å—ë—Ç —ç—Ç–æ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã:  
    `'python'`, `'sql'`, `'index'`
- –ò –ø–æ—Å—Ç—Ä–æ–∏—Ç "—Å–ª–æ–≤–∞—Ä—å", –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ:
    `'python' ‚Üí [—Å—Ç—Ä–æ–∫–∞ 1, —Å—Ç—Ä–æ–∫–∞ 5, —Å—Ç—Ä–æ–∫–∞ 42] 'sql'    ‚Üí [—Å—Ç—Ä–æ–∫–∞ 1, —Å—Ç—Ä–æ–∫–∞ 3, —Å—Ç—Ä–æ–∫–∞ 7]`

‚û°Ô∏è –ö–æ–≥–¥–∞ —Ç—ã –∏—â–µ—à—å `WHERE tags @> ARRAY['sql']`,  
PostgreSQL –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä–∏—Ç, **–≤ –∫–∞–∫–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö –µ—Å—Ç—å `sql`** ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ.

### –ú–∏–Ω—É—Å—ã GIN

- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—è–∂–µ–ª–µ–µ B-tree)
- –ë–æ–ª—å—à–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É
- –ù–µ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `INSERT`/`UPDATE` —Ç–∞–∫ –±—ã—Å—Ç—Ä–æ, –∫–∞–∫ B-tree
# –û–ø–µ—Ä–∞–Ω–¥—ã
## Exclude
`EXCLUDE` ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **–∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ** –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–æ–ª–æ–Ω–∫–∞–º, **–ø–æ –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º**, –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è—Å—å –ø—Ä–æ—Å—Ç—ã–º —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ–º (`=`), –∫–∞–∫ –≤ `UNIQUE`.

CREATE TABLE bookings (
    room_id INT,
    during TSRANGE,
    EXCLUDE USING gist (
        room_id WITH =,
        during WITH &&
    )
);

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ù–µ–ª—å–∑—è –≤—Å—Ç–∞–≤–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –µ—Å–ª–∏:
    - `room_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å—å—é **–∏**
    - `during` (–¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏) **–ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è** (`&&`) —Å –¥—Ä—É–≥–∏–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–µ.

–¢–æ –µ—Å—Ç—å —ç—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç **–¥–≤–æ–π–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**.

### –ö–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è?

–ö–æ–≥–¥–∞ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `EXCLUDE USING gist`, PostgreSQL **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç GiST-–∏–Ω–¥–µ–∫—Å**.

## Unique
CREATE TABLE users (
    email TEXT UNIQUE
);
–≠—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ:
CREATE UNIQUE INDEX users_email_key ON users(email);
üìå –¢–æ –µ—Å—Ç—å:
- –°–æ–∑–¥–∞—ë—Ç—Å—è **B-tree –∏–Ω–¥–µ–∫—Å**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
    - –ü—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ `INSERT`/`UPDATE`
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ `SELECT`, `JOIN` –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—é

## Like
`LIKE` ‚Äî —ç—Ç–æ **–æ–ø–µ—Ä–∞—Ç–æ—Ä —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ç—Ä–æ–∫–µ**. –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ `regexp-lite`.
SELECT * FROM users WHERE name LIKE 'Ivan%';
- `%` ‚Äî –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–±—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- `_` ‚Äî —Ä–æ–≤–Ω–æ **–æ–¥–∏–Ω** –ª—é–±–æ–π —Å–∏–º–≤–æ–ª
### –ü—Ä–∏–º–µ—Ä—ã:

|–£—Å–ª–æ–≤–∏–µ|–ß—Ç–æ –Ω–∞–π–¥—ë—Ç|
|---|---|
|`LIKE 'Ivan%'`|–í—Å—ë, —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "Ivan"|
|`LIKE '%an'`|–í—Å—ë, —á—Ç–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ "an"|
|`LIKE '%an%'`|–í—Å—ë, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç "an"|
|`LIKE '_van'`|–°—Ç—Ä–æ–∫–∏ –¥–ª–∏–Ω–æ–π 4, –≥–¥–µ 2-4 –±—É–∫–≤—ã ‚Äî "van"|
### pg_trgm
`pg_trgm` = **Trigram matching**, –ø–æ–∏—Å–∫ –ø–æ —Ç—Ä–æ–π–∫–∞–º —Å–∏–º–≤–æ–ª–æ–≤:
- –°–ª–æ–≤–æ `"ivan"` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞–±–æ—Ä: `'_iv', 'iva', 'van', 'an_'`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ GIN-–∏–Ω–¥–µ–∫—Å–µ
- –ü–æ—Ç–æ–º –ø–æ–∏—Å–∫ –ø–æ `LIKE '%va%'` –ø—Ä–æ—Å—Ç–æ –∏—â–µ—Ç "–µ—Å—Ç—å –ª–∏ —Ç—Ä–∏–≥—Ä–∞–º–º–∞ `va`"

üìà –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ–≥—Ä–æ–º–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö (–≤ 10‚Äì100 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º `Seq Scan`).
### –£—Å–∫–æ—Ä–µ–Ω–∏–µ `LIKE`, `ILIKE`, `SIMILAR TO` —á–µ—Ä–µ–∑ `pg_trgm`

CREATE EXTENSION IF NOT EXISTS pg_trgm;

CREATE INDEX idx_name_trgm ON users
USING gin (name gin_trgm_ops);

SELECT * FROM users WHERE name ILIKE '%vaN%';

### –ü—Ä–∏–º–µ—Ä—ã:
# –°–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PSQL

## 1. –ü—Ä–æ—Å—Ç–æ–π
CREATE INDEX idx_name ON table_name(column_name);

## 2. –ò–Ω–¥–µ–∫—Å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞
CREATE INDEX idx_hash ON table_name USING hash(column_name);
CREATE INDEX idx_gin ON documents USING gin(jsonb_column);
CREATE INDEX idx_gist ON spatial_data USING gist(geom);

## 3. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (UNIQUE)
CREATE UNIQUE INDEX idx_unique_column ON my_table(column_name);

## 4. –ò–Ω–¥–µ–∫—Å –Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
CREATE INDEX idx_lower_name ON my_table(LOWER(name));
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –∫–æ–ª–æ–Ω–∫—É, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è.

## 5. –ß–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_active ON my_table(status) WHERE status = 'active';
- –•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ –∏ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–±–æ—Ä–∫—É –ø–æ —É—Å–ª–æ–≤–∏—é.

## 6. INCLUDE-–∏–Ω–¥–µ–∫—Å (–ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π)**

CREATE INDEX idx_user_search ON users(username) INCLUDE(email, created_at);
- –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á ‚Äî `username`, –Ω–æ `email` –∏ `created_at` —Ç–æ–∂–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è `SELECT`.

## 7. CONCURRENTLY (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
CREATE INDEX CONCURRENTLY idx_con ON my_table(column_name);
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–∞.
- –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

## –ù–µ—è–≤–Ω—ã–µ

### 1. PRIMARY KEY
CREATE TABLE users (
    id SERIAL PRIMARY KEY
);
‚û°Ô∏è PostgreSQL **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π B-tree –∏–Ω–¥–µ–∫—Å** –ø–æ `id`.

### 2. UNIQUE CONSTRAINT
CREATE TABLE users (
    email TEXT UNIQUE
);
### 3. EXCLUDE USING (–¥–ª—è GiST, SP-GiST)
CREATE TABLE bookings (
    room_id INT,
    during TSRANGE,
    EXCLUDE USING gist (room_id WITH =, during WITH &&)
);

### 4. FOREIGN KEY ‚Äî –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å!
> –í–∞–∂–Ω–æ: `FOREIGN KEY` **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å `JOIN` –∏–ª–∏ `DELETE/UPDATE` –ø–æ –≤–Ω–µ—à–Ω–µ–º—É –∫–ª—é—á—É ‚Äî –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –≤—Ä—É—á–Ω—É—é:


### –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ:
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'my_table';